<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon ‚Äî –≠–∫–æ–ª–æ–≥–∏—è –≤ –∫–æ–¥–µ</title>
    <style>
        :root {
            --apple-bg: #f5f5f7;
            --apple-card: rgba(255, 255, 255, 0.72);
            --apple-blue: #0071e3;
            --apple-text: #1d1d1f;
            --apple-gray: #86868b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", sans-serif;
            background-color: var(--apple-bg);
            color: var(--apple-text);
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            -webkit-font-smoothing: antialiased;
            overflow: hidden;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        nav {
            position: absolute;
            top: 0; width: 100%; padding: 20px 40px;
            display: flex; justify-content: flex-end;
            box-sizing: border-box;
        }

        .nav-link {
            color: var(--apple-blue);
            text-decoration: none;
            font-size: 14px;
            font-weight: 400;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .hero {
            text-align: center;
            width: 100%; max-width: 500px;
            padding: 40px;
            background: var(--apple-card);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 34px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.05);
            animation: slideUp 1s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        h1 { font-size: 40px; font-weight: 600; letter-spacing: -1px; margin-bottom: 8px; }
        .subtitle { color: var(--apple-gray); font-size: 17px; margin-bottom: 35px; }

        /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
        input {
            width: 100%;
            padding: 18px 20px;
            margin-bottom: 12px;
            border-radius: 14px;
            border: 1px solid #d2d2d7;
            background: rgba(255,255,255,0.8);
            font-size: 17px;
            outline: none;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        input:focus { border-color: var(--apple-blue); box-shadow: 0 0 0 4px rgba(0,113,227,0.1); }

        button {
            width: 100%;
            padding: 18px;
            border-radius: 14px;
            border: none;
            background: var(--apple-blue);
            color: #fff;
            font-size: 17px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
        }

        button:active { transform: scale(0.98); }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.15);
            backdrop-filter: blur(15px);
            z-index: 100;
            align-items: center; justify-content: center;
        }

        .modal-content {
            background: #fff;
            padding: 40px;
            border-radius: 28px;
            width: 320px;
            text-align: center;
            box-shadow: 0 30px 60px rgba(0,0,0,0.1);
        }

        #status { margin-top: 30px; min-height: 40px; }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>

<nav>
    <a class="nav-link" onclick="openAuth()">–í–æ–π—Ç–∏</a>
</nav>

<div class="hero">
    <h1>Carbon</h1>
    <p class="subtitle">–ß–∏—Å—Ç—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å.</p>
    
    <input type="text" id="urlInput" placeholder="URL –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞" autocomplete="off">
    <button onclick="startScan()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>

    <div id="status"></div>
</div>

<div id="authModal" class="modal">
    <div class="modal-content">
        <h2 id="modalTitle" style="margin-top:0">–í—Ö–æ–¥</h2>
        <input type="email" id="authEmail" placeholder="Email">
        <input type="password" id="authPassword" placeholder="–ü–∞—Ä–æ–ª—å">
        <button onclick="handleAuth()" id="authBtn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        <p style="font-size:13px; color:var(--apple-gray); margin-top:20px;">
            <span id="toggleText">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</span> 
            <a onclick="toggleAuthMode()" style="color:var(--apple-blue); cursor:pointer">–°–æ–∑–¥–∞—Ç—å</a>
        </p>
        <a onclick="closeAuth()" style="font-size:13px; color:var(--apple-gray); cursor:pointer; display:block; margin-top:15px;">–û—Ç–º–µ–Ω–∞</a>
    </div>
</div>

<script>
    let isLoginMode = true;

    // --- –õ–æ–≥–∏–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è ---
    async function startScan() {
        const url = document.getElementById('urlInput').value;
        const status = document.getElementById('status');
        if(!url) return;

        status.innerHTML = '<p style="color:var(--apple-blue); font-size:15px;">üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É...</p>';

        try {
            await fetch('/api/scan', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ url })
            });

            setTimeout(() => {
                status.innerHTML = `
                    <p style="color:#28a745; font-weight:500; margin-bottom:15px;">–ê–Ω–∞–ª–∏–∑ –≥–æ—Ç–æ–≤</p>
                    <img src="/api/badge?url=${encodeURIComponent(url)}" style="border-radius:6px; box-shadow:0 4px 12px rgba(0,0,0,0.1)">
                `;
            }, 13000);
        } catch(e) { status.innerText = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è'; }
    }

    // --- –õ–æ–≥–∏–∫–∞ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ---
    function openAuth() { document.getElementById('authModal').style.display = 'flex'; }
    function closeAuth() { document.getElementById('authModal').style.display = 'none'; }

    function toggleAuthMode() {
        isLoginMode = !isLoginMode;
        document.getElementById('modalTitle').innerText = isLoginMode ? '–í—Ö–æ–¥' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
        document.getElementById('authBtn').innerText = isLoginMode ? '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç';
        document.getElementById('toggleText').innerText = isLoginMode ? '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?' : '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?';
    }

    async function handleAuth() {
        const email = document.getElementById('authEmail').value;
        const password = document.getElementById('authPassword').value;
        const endpoint = isLoginMode ? '/api/login' : '/api/register';

        const res = await fetch(endpoint, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ email, password })
        });

        if (res.ok) {
            alert(isLoginMode ? '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
            closeAuth();
            // –ù–∞ —Å–ª–µ–¥—É—é—â–µ–º —ç—Ç–∞–ø–µ –º—ã —Å–¥–µ–ª–∞–µ–º –∑–¥–µ—Å—å –ø–µ—Ä–µ—Ö–æ–¥ –≤ Dashboard
        } else {
            alert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ.');
        }
    }
</script>

</body>
</html>
